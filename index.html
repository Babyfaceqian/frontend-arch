<!DOCTYPE html>
<meta charset="utf-8">
<style>
</style>
<canvas id="" width="800" height="500"></canvas>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
    var chart = d3.select("canvas")
        .attr("width", 400)
        .attr("height", 300);
    var context = chart.node().getContext("2d");

    // Create an in memory only element of type 'custom'
    var detachedContainer = document.createElement("custom");

    // Create a d3 selection for the detached container. We won't
    // actually be attaching it to the DOM.
    var dataContainer = d3.select(detachedContainer);

    // Function to create our custom data containers
    function drawCustom(data) {
        var scale = d3.scaleLinear()
            .range([10, 390])
            .domain(d3.extent(data));

        var dataBinding = dataContainer.selectAll("custom.circle")
            .data(data, function (d) {
                return d;
            });

        dataBinding
            .attr("r", 8)
            .transition()
            .duration(1000)
            .attr("r", 15)
            .attr("fillStyle", "green");

        dataBinding.enter()
            .append("custom")
            .classed("circle", true)
            .attr("cx", scale)
            .attr("cy", 100)
            .attr("r", 8)
            .attr("fillStyle", "red");

        dataBinding.exit()
            .attr("r", 8)
            .transition()
            .duration(1000)
            .attr("r", 5)
            .attr("fillStyle", "lightgrey");

    }
    chart.call(d3.drag()
    .on('start', dragStart))
    .on('drag', dragging())
    .on('end', dragEnd)
    var start_x, start_y;
    function dragStart() {
        start_x = d3.event.x;
        start_y = d3.event.y;
        var elements = dataContainer.selectAll("custom.circle");
        console.log('elements', elements);
        elements.each(function (d) {
            var node = d3.select(this);
            
        })
        console.log('dragStart', start_x, start_y);
    }
    function dragging() {
        console.log('dragging')
    }
    function dragEnd() {
        console.log('dragEnd')
    }
    // Function to render out to canvas our custom
    // in memory nodes
    function drawCanvas() {
        // clear canvas
        context.fillStyle = "#fff";
        context.rect(0, 0, chart.attr("width"), chart.attr("height"));
        context.fill();

        // select our dummy nodes and draw the data to canvas.
        var elements = dataContainer.selectAll("custom.circle");
        elements.each(function (d) {
            var node = d3.select(this);

            context.beginPath();
            context.fillStyle = node.attr("fillStyle");
            context.arc(node.attr("cx"), node.attr("cy"), node.attr("r"), 0, 2 * Math.PI);
            context.fill();
            context.closePath();

        })
    }
    // chart.call(d3.zoom().on("zoom", zoomed))

    function zoomed() {
        console.log('zoomed', d3.event.transform.k)
        context.scale(d3.event.transform.k, d3.event.transform.k)
    }
    var t = d3.timer(drawCanvas);
    drawCustom([1, 2, 13, 20, 23]);
    drawCustom([1, 2, 12, 16, 20]);
</script>