<html>

<head>
    <meta charset="utf-8" />
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="lib/d3-canvas-transition.js"></script>
</head>

<body>
    <canvas id="svg" width="500" height="400"></canvas>
    <script>
        (function () {
            var svg = d3.select('#svg');
            var data = [];
            // 创建数据
            d3.range(2).forEach(function (el) {
                data.push({
                    value: el
                });
            });
            var nodeGroup = svg.append('g').attr('class', 'nodeGroup');
            var nodes = nodeGroup.selectAll('.node').data(data);
            var newNodes = nodes.enter().append('g').attr('class', 'node');
            let zoom = d3.zoom().scaleExtent([1, 8]).on("zoom", function () {
                let transform = d3.event.transform;
                console.log('transform', transform)
                // newNodes.each(function () {
                //     let trans = d3.select(this).attr('transform');
                //     const {
                //         x,
                //         y,
                //         angle,
                //         sx,
                //         sy
                //     } = parseTransform(trans);
                //     console.log('dddd', x, y, trans);
                //     trans = stringfyTransform({
                //         x,
                //         y,
                //         angle,
                //         sx: transform.k,
                //         sy: transform.k
                //     });
                //     d3.select(this).attr('transform', trans);
                // })
            })
            svg.call(zoom);
            newNodes.attr('x', function (d, i) {
                return 20 * (i + 1);
            }).attr('y', function (d, i) {
                return 20;
            });
            // newNodes.attr('scale', 1)
            // newNodes.attr('transform', 'translate(0,0)').transition().duration(1000).attr('transform',
            //     'translate(200,200)')
            var nodeEle = newNodes.append('circle')
                // .attr('cx', 200)
                // .attr('cy', 200)
                .attr('r', 5)
                .style('fill', 'black')

            function parseTransform(trans) {
                if (typeof trans === 'string') {
                    let index1 = trans.indexOf('translate('),
                        index2,
                        s,
                        bits,
                        x = 0,
                        y = 0,
                        angle = 0,
                        sx = 1,
                        sy = 1;
                    if (index1 > -1) {
                        s = trans.substring(index1 + 10);
                        index2 = s.indexOf(')');
                        bits = s.substring(0, index2).split(',');
                        x += +bits[0];
                        if (bits.length === 2) y += +bits[1];
                    }

                    index1 = trans.indexOf('rotate(');
                    if (index1 > -1) {
                        s = trans.substring(index1 + 7);
                        angle = +s.substring(0, s.indexOf(')'));
                    }

                    index1 = trans.indexOf('scale(');
                    if (index1 > -1) {
                        s = trans.substring(index1 + 6);
                        index2 = s.indexOf(')');
                        bits = s.substring(0, index2).split(',');
                        sx = +bits[0];
                        if (bits.length === 2) sy = +bits[1];
                    }
                    return {
                        x,
                        y,
                        angle,
                        sx,
                        sy
                    }
                } else {
                    return {
                        x: 0,
                        y: 0,
                        angle: 0,
                        sx: 1,
                        sy: 1
                    }
                }
            }

            function stringfyTransform({
                x,
                y,
                angle,
                sx,
                sy
            }) {
                return 'translate(' + x + ',' + y + ') ' + 'rotate(' + angle + ') ' + 'scale(' + sx + ',' + sy +
                    ')';
            }
        })()
    </script>
</body>

</html>